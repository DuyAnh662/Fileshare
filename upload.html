<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Upload files to your Google Drive and share them securely. No size limits, completely free.">
    <title>Upload File - Secure & Free Sharing</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="js/head.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="container header-content">
            <a href="index.html" class="logo">
                <span class="logo-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" />
                    </svg>
                </span>
                <span>FileShare</span>
            </a>

            <button class="menu-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <line x1="4" x2="20" y1="12" y2="12" />
                    <line x1="4" x2="20" y1="6" y2="6" />
                    <line x1="4" x2="20" y1="18" y2="18" />
                </svg>
            </button>

            <nav class="nav">
                <a href="index.html" class="nav-link">Home</a>
                <a href="files.html" class="nav-link">Files</a>
                <a href="upload.html" class="nav-link active">Upload</a>
                <a href="donate.html" class="nav-link" style="font-weight: 600;">Support</a>
                <button class="nav-icon-btn" onclick="openSettingsModal()" title="Settings">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="-1 -1 26 26" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3" />
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                    </svg>
                </button>
            </nav>
        </div>
    </header>

    <!-- Page Header -->
    <div class="page-header">
        <div class="container">
            <h1 class="page-title">
                <span class="icon icon-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <polyline points="17 8 12 3 7 8" />
                        <line x1="12" x2="12" y1="3" y2="15" />
                    </svg>
                </span>
                <span>Upload File</span>
            </h1>
            <p class="page-subtitle">Share your file with the community</p>
        </div>
    </div>

    <!-- Main Content -->
    <main class="section">
        <div class="container" style="max-width: 640px;">

            <!-- Instructions -->
            <div class="alert alert-info mb-4">
                <span class="alert-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <circle cx="12" cy="12" r="10" />
                        <path d="M12 16v-4" />
                        <path d="M12 8h.01" />
                    </svg>
                </span>
                <div>
                    <strong>Quick Guide:</strong>
                    <ol style="margin-top: 8px; padding-left: 20px; color: inherit;">
                        <li>Upload your file to your personal Google Drive</li>
                        <li>Right-click the file → Share → Change to "Anyone with the link"</li>
                        <li>Copy the link and paste it into the form below</li>
                    </ol>
                </div>
            </div>

            <!-- Upload Status -->
            <div id="upload-status-container" class="mb-4">
                <!-- Rate limit status will be loaded here -->
            </div>

            <!-- Upload Form -->
            <div class="card">
                <form id="upload-form">
                    <div class="form-group">
                        <label class="form-label" for="title">File Name *</label>
                        <input type="text" id="title" name="title" class="form-input"
                            placeholder="e.g. Facebook Lite App v1.0" required maxlength="255">
                        <p class="form-hint">Use a clear name to help others search</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="description">Description</label>
                        <textarea id="description" name="description" class="form-textarea"
                            placeholder="Short description (features, requirements, installation guide...)"
                            rows="4"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="file_type">File Type *</label>
                        <select id="file_type" name="file_type" class="form-select" required>
                            <option value="">-- Select file type --</option>
                            <option value="apk">APK (Android)</option>
                            <option value="ipa">IPA (iOS)</option>
                            <option value="exe">EXE (Windows)</option>
                            <option value="zip">ZIP/RAR</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="drive_link">Google Drive Link *</label>
                        <input type="url" id="drive_link" name="drive_link" class="form-input"
                            placeholder="https://drive.google.com/file/d/..." required>
                        <p class="form-hint">Make sure sharing is set to "Anyone with the link can view"</p>
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: flex-start; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="agree_terms" required
                                style="margin-top: 4px; width: 18px; height: 18px;">
                            <span class="text-muted" style="font-size: 0.9rem;">
                                I confirm this file does not violate copyright, contains no virus/malware,
                                and I am responsible for the content.
                            </span>
                            <a href="terms.html" target="_blank">View Terms</a>.
                        </label>
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg w-100 mt-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="m22 2-7 20-4-9-9-4Z" />
                            <path d="M22 2 11 13" />
                        </svg>
                        <span>Submit File</span>
                    </button>
                </form>
            </div>

            <div id="success-message" class="alert alert-success mt-3 hidden">
                <span class="alert-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                        <polyline points="22 4 12 14.01 9 11.01" />
                    </svg>
                </span>
                <div>
                    <strong>Submit successful!</strong><br>
                    <span>Your file is pending Admin review. Once approved, it will appear in the public list.</span>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>FileShare</h4>
                    <p class="text-muted">File sharing platform via Google Drive. Simple, safe, and free.</p>
                </div>

                <div class="footer-section">
                    <h4>Navigation</h4>
                    <ul class="footer-links">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="files.html">File List</a></li>
                        <li><a href="upload.html">Upload File</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h4>Legal</h4>
                    <ul class="footer-links">
                        <li><a href="terms.html">Terms of Use</a></li>
                        <li><a href="privacy.html">Privacy Policy</a></li>
                        <li><a href="dmca.html">Report Violation</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>© 2026 FileShare. No file storage - Metadata only.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/icons.js"></script>
    <script src="js/custom-select.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/rateLimit.js"></script>
    <script src="js/lootlabs.js"></script>
    <script src="js/api.js"></script>
    <script>
        const form = document.getElementById('upload-form');
        const successMessage = document.getElementById('success-message');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = `<div class="spinner" style="width:18px;height:18px;border-width:2px;"></div> Sending...`;

            const formData = {
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                file_type: document.getElementById('file_type').value,
                drive_link: document.getElementById('drive_link').value
            };

            if (!utils.isValidDriveLink(formData.drive_link)) {
                utils.showToast('Invalid Google Drive link', 'error');
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
                return;
            }

            const result = await api.submitFile(formData);

            if (result.success) {
                form.reset();
                form.classList.add('hidden');
                successMessage.classList.remove('hidden');
                utils.showToast('Submit successful!', 'success');
                // Refresh rate limit status
                loadUploadStatus();
            } else {
                utils.showToast(result.error || 'An error occurred during submission', 'error');
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        });

        // Load rate limit status on page load
        async function loadUploadStatus() {
            const container = document.getElementById('upload-status-container');
            try {
                const { html, status } = await rateLimit.renderUploadStatus();
                container.innerHTML = html;

                // Disable form if no uploads remaining
                if (!status.allowed) {
                    const formCard = document.querySelector('.card:has(#upload-form)');
                    if (formCard) {
                        formCard.style.opacity = '0.6';
                        formCard.style.pointerEvents = 'none';
                    }
                }
            } catch (error) {
                console.error('Error loading upload status:', error);
                container.innerHTML = ''; // Hide on error
            }
        }

        // Load status when page is ready
        document.addEventListener('DOMContentLoaded', loadUploadStatus);
    </script>
</body>

</html>